services:
  # ============================================================================
  # Video Processing Server
  # ============================================================================
  video-server:
    image: zencourt-video-server:latest
    build:
      context: ../..
      dockerfile: apps/video-server/Dockerfile
    container_name: zencourt-video-server
    ports:
      - "3001:3001"
    env_file:
      - ../../.env.local
    environment:
      NODE_ENV: development
      PORT: 3001
      LOG_LEVEL: debug

      # Vercel Webhook Configuration
      VERCEL_WEBHOOK_SECRET: ${VERCEL_WEBHOOK_SECRET}
      VIDEO_SERVER_API_KEY: ${VIDEO_SERVER_API_KEY}

      # Processing Configuration
      TEMP_DIR: /tmp/video-processing
      REMOTION_CACHE_DIR: /tmp/remotion

      # fal.ai Configuration
      FAL_WEBHOOK_URL: ${FAL_WEBHOOK_URL:-http://host.docker.internal:3001/webhooks/fal}
    # volumes:
    #   # Mount source code for hot reload in development
    #   - ./src:/app/src:ro
    #   - ./dist:/app/dist
    command:
      - sh
      - -c
      - >-
        mkdir -p /tmp/remotion /tmp/video-processing
        && node apps/video-server/dist/apps/video-server/src/server.js
    restart: unless-stopped
